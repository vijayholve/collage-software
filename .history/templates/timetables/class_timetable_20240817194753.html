# views.py

from django.shortcuts import render, get_object_or_404
from .models import ClassGroup, Timetable

def class_timetable(request, classgroup_id):
    classgroup = get_object_or_404(ClassGroup, id=classgroup_id)
    timetable_entries = Timetable.objects.filter(class_group=classgroup).order_by('day', 'start_time')

    # Prepare unique time slots
    time_slots = timetable_entries.values('start_time', 'end_time').distinct()

    # Structure data for the template
    timetable_dict = {}
    for entry in timetable_entries:
        key = (entry.start_time, entry.end_time)
        if key not in timetable_dict:
            timetable_dict[key] = {}
        timetable_dict[key][entry.day] = entry

    days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]
    context = {
        'classgroup': classgroup,
        'timetable_dict': timetable_dict,
        'time_slots': time_slots,
        'days': days
    }
    return render(request, 'timetables/class_timetable.html', context)
